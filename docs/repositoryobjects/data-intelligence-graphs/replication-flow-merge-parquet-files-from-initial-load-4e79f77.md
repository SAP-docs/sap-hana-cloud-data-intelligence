<!-- loio4e79f7788dc94d4d80571914568aa570 -->

# Replication Flow: Merge Parquet Files From Initial Load

This scenario showcases how to merge small sized files that are generated by the Replication Management Service \(RMS\) tool into bigger, configurable sizes.



For using this graph, a source location pointing to the initial load of an RMS execution and a target location to store the results are necessary. The initial load must have been completed, which means that a "\_SUCCESS" file exists in the source directory.

The graph starts by copying the metadata files, then a Python script gets a list of all the part files that represent the initial load operation and starts combining them.

When the configured limits are reached, the data is sent to the Write File operator, which creates the new part files. When all parts are transformed, the graph will create a "\_SUCCESS" file and complete.

The limits consider the size of the original part files, which mean that the combination of multiple parts might actually result in parts smaller thant the configured *Target File Size* due to compression.

Here are the details about the parameters that need to be configured for the graph to work properly.



<a name="loio4e79f7788dc94d4d80571914568aa570__section_mmn_zlk_ntb"/>

## Configurations

All the required configurations will be stored as configuration substitutions, so that there is no need to configure each operator separately, but only the graph:

1.  *Target File Size*: Desired target size for the resulting part files. Can be set using basic units in the format "`<number>` `<UNIT>`", where `<UNIT>` can be B, KB, MB, or GB. If no unit is specified, the number will be interpreted as bytes. If the configuration is empty, the default value of 256 MB is used.

    > ### Example:  
    > 256 KB, 1024 kb, 1 MB, 256 mb, 1 GB, ...

2.  *Source Path*: Location where the source table was replicated by RMS.

    > ### Note:  
    > The graph requires the table path, so that each execution deals with a single table.

    > ### Example:  
    > bucket-name/folder1/folder2/table.parquet

3.  *Source Connection ID*: Name of the connection to the storage service containing the source files. This connection must be available in the Connection Management tool.

    > ### Example:  
    > S3\_Connection, MyConnection, ...

4.  *Target Path*: Location where the resulting part files will be saved. It is recommended to point to an empty directory.

    > ### Example:  
    > bys3bucket/resultfiles/table.parquet, mygcs/resultfiles/table.parquet

5.  *Target Connection ID*: Name of the connection to the storage service where the resulting part files will be saved. This connection must be available in the Connection Management tool. It can be the same as the *Source Connection ID*.

    > ### Example:  
    > S3\_Connection, MyConnection, ...


